<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ“¬çœŸé€è¦–æ¡Œçƒ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            background-color: #333;
            color: white;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        h1 {
            margin-bottom: 10px;
            font-size: 2rem;
            letter-spacing: 2px;
        }

        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
        }

        button {
            padding: 8px 16px;
            font-size: 15px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #555;
            color: white;
            transition: background 0.3s;
        }

        button:hover {
            background-color: #777;
        }

        button.active {
            background-color: #d11d1d; /* ç´…è‰²å¼·èª¿ */
            color: #fff;
            font-weight: bold;
        }

        #gameCanvas {
            /* ç•«å¸ƒå¯¬é«˜æ¯”æ¨¡æ“¬æ¡Œçƒæ¡Œçš„é•·å¯¬ */
            border: 4px solid #fff;
            background-color: #008f4c; /* æ¡Œçƒæ¡Œç¶ è‰² */
            cursor: none;
            box-shadow: 0 0 30px rgba(0,0,0,0.8);
        }

        .instruction {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #aaa;
        }
    </style>
</head>
<body>

    <h1>ğŸ¾ æ“¬çœŸé€è¦–æ¡Œçƒ</h1>

    <div class="controls">
        <button onclick="setDifficulty('easy')" id="btn-easy" class="active">ç°¡å–®</button>
        <button onclick="setDifficulty('medium')" id="btn-medium">ä¸­ç­‰</button>
        <button onclick="setDifficulty('hard')" id="btn-hard">å›°é›£</button>
    </div>

    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <div class="instruction">
        **æ“¬çœŸæ§åˆ¶ï¼š** æ»‘é¼ ç§»å‹•æ§åˆ¶çƒæ‹ä½ç½®ã€‚**å¿«é€Ÿæ®å‹•æ»‘é¼ **å¯ä»¥è®“çƒåå½ˆçš„è§’åº¦æ›´åˆé‘½ï¼Œæ¨¡æ“¬æ®æ‹åŠ›é‡ã€‚
    </div>

<script>
    // --- éŠæˆ²åˆå§‹åŒ–è¨­å®š ---
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    const WINNING_SCORE = 10;
    let difficultyLevel = 0.04; // AI è¿½è¹¤ä¿‚æ•¸
    
    // éŠæˆ²ç‰©ä»¶åƒæ•¸
    const PADDLE_HEIGHT = 15;
    const PADDLE_WIDTH = 100;

    // ç©å®¶ (åº•ç·š)
    const user = {
        x: canvas.width / 2 - PADDLE_WIDTH / 2, 
        y: canvas.height - 30, // é è¿‘åº•ç·š
        width: PADDLE_WIDTH,
        height: PADDLE_HEIGHT,
        color: "#1e90ff",
        score: 0,
        // é¡å¤–çš„æ§åˆ¶è®Šæ•¸
        velX: 0, // ç”¨æ–¼æ¨¡æ“¬æ®æ‹åŠ›é‡çš„ X è»¸é€Ÿåº¦
        prevX: 0
    };

    // é›»è…¦ (é ‚ç·š)
    const com = {
        x: canvas.width / 2 - PADDLE_WIDTH / 2, 
        y: 10, 
        width: PADDLE_WIDTH,
        height: PADDLE_HEIGHT,
        color: "#d11d1d",
        score: 0
    };

    // çƒ
    const ball = {
        x: canvas.width / 2,
        y: canvas.height / 2,
        radius: 8,
        speed: 5,
        velocityX: 0,
        velocityY: 5,
        color: "white"
    };

    // --- ç¹ªåœ–å‡½æ•¸ ---

    // ç¹ªè£½æ¡Œçƒæ¡Œçš„ç¶²å­ (ä¸­ç·š)
    function drawNet() {
        ctx.strokeStyle = "white";
        ctx.lineWidth = 4;
        ctx.setLineDash([10, 10]); // è™›ç·š
        ctx.beginPath();
        ctx.moveTo(0, canvas.height / 2);
        ctx.lineTo(canvas.width, canvas.height / 2);
        ctx.stroke();
        ctx.setLineDash([]); // æ¢å¾©å¯¦ç·š
    }

    function drawText(text, x, y, color) {
        ctx.fillStyle = color;
        ctx.font = "30px sans-serif";
        ctx.fillText(text, x, y);
    }

    // ç¹ªè£½çƒæ‹ (ä½¿ç”¨é™°å½±å¢åŠ ç«‹é«”æ„Ÿ)
    function drawPaddle(p) {
        ctx.fillStyle = p.color;
        ctx.shadowColor = 'black';
        ctx.shadowBlur = 10;
        ctx.fillRect(p.x, p.y, p.width, p.height);
        ctx.shadowBlur = 0; // ç¹ªè£½å®Œç•¢æ¸…é™¤é™°å½±
    }

    // ç¹ªè£½çƒ (æ ¹æ“š Y è»¸ä½ç½®ç¸®æ”¾å¤§å°ï¼Œæ¨¡æ“¬é€è¦–æ„Ÿ)
    function drawBall(b) {
        // ç¸®æ”¾ä¿‚æ•¸ (0.5 åˆ° 1.5 ä¹‹é–“)
        // è¶Šé è¿‘åº•ç·š (y=600), scale è¶Šæ¥è¿‘ 1.5 (çƒè¶Šå¤§)
        // è¶Šé è¿‘é ‚ç·š (y=0), scale è¶Šæ¥è¿‘ 0.5 (çƒè¶Šå°)
        const scaleFactor = 0.5 + (b.y / canvas.height) * 1.0; 
        const currentRadius = b.radius * scaleFactor;

        ctx.fillStyle = b.color;
        ctx.shadowColor = 'yellow';
        ctx.shadowBlur = 5;
        ctx.beginPath();
        ctx.arc(b.x, b.y, currentRadius, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.fill();
        ctx.shadowBlur = 0;
    }

    // --- éŠæˆ²æ§åˆ¶èˆ‡é‚è¼¯ ---

    canvas.addEventListener("mousemove", getMousePos);

    function getMousePos(evt) {
        let rect = canvas.getBoundingClientRect();
        let mouseX = evt.clientX - rect.left;
        let mouseY = evt.clientY - rect.top;

        // 1. ç©å®¶çƒæ‹ X è»¸ç§»å‹• (å·¦å³)
        // è®“çƒæ‹ä¸­å¿ƒå°é½Šæ»‘é¼  X è»¸
        user.x = mouseX - user.width / 2;

        // 2. ç©å®¶çƒæ‹ Y è»¸é™åˆ¶ (å‰å¾Œ)
        // é™åˆ¶ç©å®¶åªèƒ½åœ¨é è¿‘åº•ç·šçš„å€åŸŸç§»å‹• (ç´„ç•«å¸ƒçš„æœ€å¾Œ 1/5)
        const minY = canvas.height * 0.75;
        user.y = Math.max(minY, mouseY - user.height / 2);
        user.y = Math.min(canvas.height - user.height, user.y);

        // 3. è¨ˆç®—æ®æ‹åŠ›é‡ (æ¨¡æ“¬æ®æ‹é€Ÿåº¦)
        // æ®æ‹åŠ›é‡å–æ±ºæ–¼æ»‘é¼  X è»¸ç§»å‹•é€Ÿåº¦
        user.velX = (mouseX - user.prevX) * 0.1; // ä¹˜ä»¥ä¿‚æ•¸æ§åˆ¶å¼·åº¦
        user.prevX = mouseX;

        // é‚Šç•Œæª¢æŸ¥
        if (user.x < 0) user.x = 0;
        if (user.x + user.width > canvas.width) user.x = canvas.width - user.width;
    }

    // ç¢°æ’æª¢æ¸¬ (ç°¡åŒ–ç‰ˆ AABB)
    function collision(b, p) {
        p.top = p.y;
        p.bottom = p.y + p.height;
        p.left = p.x;
        p.right = p.x + p.width;

        b.top = b.y - b.radius;
        b.bottom = b.y + b.radius;
        b.left = b.x - b.radius;
        b.right = b.x + b.radius;

        return p.left < b.right && p.top < b.bottom && p.right > b.left && p.bottom > b.top;
    }

    function resetBall() {
        ball.x = canvas.width / 2;
        ball.y = canvas.height / 2;
        ball.speed = 5;
        ball.velocityY = -ball.velocityY; // æ›é‚Šç™¼çƒ
        ball.velocityX = (Math.random() - 0.5) * ball.speed * 0.5; // è¼•å¾®éš¨æ©Ÿ X è»¸
    }

    // æ ¸å¿ƒæ›´æ–°é‚è¼¯
    function update() {
        // æ›´æ–°çƒçš„ä½ç½®
        ball.x += ball.velocityX;
        ball.y += ball.velocityY;

        // AI é‚è¼¯ï¼šåªåœ¨ X è»¸ä¸Šè¿½è¹¤çƒçš„ä½ç½®
        const comCenterX = com.x + com.width / 2;
        const targetX = ball.x;
        // AI è¿½è¹¤é€Ÿåº¦å— difficultyLevel å½±éŸ¿
        com.x += (targetX - comCenterX) * difficultyLevel; 

        // AI é‚Šç•Œæª¢æŸ¥
        if(com.x < 0) com.x = 0;
        if(com.x + com.width > canvas.width) com.x = canvas.width - com.width;

        // çƒç¢°åˆ°å·¦å³é‚Šç·£åå½ˆ
        if (ball.x - ball.radius < 0 || ball.x + ball.radius > canvas.width) {
            ball.velocityX = -ball.velocityX;
        }

        // ç¢°æ’èˆ‡æ®æ‹é‚è¼¯
        let player = (ball.y < canvas.height / 2) ? com : user; // åˆ¤æ–·çƒåœ¨èª°çš„åŠå ´

        if (collision(ball, player)) {
            // çƒæ‹ä¸­å¿ƒé»çš„ç›¸å°ä½ç½® (-1 åˆ° 1)
            let collidePoint = (ball.x - (player.x + player.width / 2));
            collidePoint = collidePoint / (player.width / 2);

            // èª¿æ•´çƒçš„ Y è»¸é€Ÿåº¦ (åå½ˆ)
            ball.velocityY = -ball.velocityY;

            // **æ“¬çœŸæ®æ‹åŠ›é‡æ¨¡æ“¬**
            if (player === user) {
                // ç©å®¶æ®æ‹æ™‚ï¼Œå°‡æ»‘é¼ ç§»å‹•çš„é€Ÿåº¦ (user.velX) åŠ åˆ°çƒçš„ X è»¸é€Ÿåº¦ä¸Š
                ball.velocityX += user.velX * 0.8; 
            } else {
                // é›»è…¦æ“Šçƒæ™‚ï¼Œæ ¹æ“šæ“Šä¸­ä½ç½®è¨­å®šè§’åº¦ï¼Œä¸åŠ é¡å¤–åŠ›é‡
                ball.velocityX = collidePoint * ball.speed * 0.4;
            }

            // é™åˆ¶ X è»¸é€Ÿåº¦ï¼Œé˜²æ­¢çƒé£›å¤ªå¿«æˆ–è§’åº¦å¤ªå¥‡æ€ª
            const maxVelocityX = 10;
            if(ball.velocityX > maxVelocityX) ball.velocityX = maxVelocityX;
            if(ball.velocityX < -maxVelocityX) ball.velocityX = -maxVelocityX;

            // æ¯æ¬¡æ“Šçƒå¾Œç¨å¾®åŠ é€Ÿ
            ball.speed += 0.2;
            if (ball.speed > 18) ball.speed = 18; // é€Ÿåº¦ä¸Šé™
            
            // é‡æ–°è¨ˆç®— Y è»¸é€Ÿåº¦ï¼Œä¿æŒæ•´é«”é€Ÿåº¦ç©©å®š
            ball.velocityY = Math.sign(ball.velocityY) * Math.sqrt(ball.speed * ball.speed - ball.velocityX * ball.velocityX);
        }

        // å¾—åˆ†åˆ¤å®š (çƒè¶…å‡ºé ‚ç·šæˆ–åº•ç·š)
        if (ball.y - ball.radius < 0) {
            user.score++;
            checkWin();
            resetBall();
        } else if (ball.y + ball.radius > canvas.height) {
            com.score++;
            checkWin();
            resetBall();
        }
    }

    function checkWin(){
        if(user.score >= WINNING_SCORE || com.score >= WINNING_SCORE){
            let winner = user.score >= WINNING_SCORE ? "ä½ è´äº†ï¼" : "é›»è…¦è´äº†ï¼";
            alert(winner + " é»æ“Šç¢ºå®šé‡æ–°é–‹å§‹ã€‚");
            user.score = 0;
            com.score = 0;
            ball.speed = 5;
        }
    }

    // æ¸²æŸ“ç•«é¢
    function render() {
        // ç•«å¸ƒèƒŒæ™¯ (æ¡Œçƒæ¡Œåº•è‰²)
        ctx.fillStyle = "#008f4c"; 
        ctx.fillRect(0, 0, canvas.width, canvas.height); 

        drawNet();

        // ç•«ç·šæ¢å¼·èª¿æ¡Œçƒæ¡Œé‚Šç·£
        ctx.strokeStyle = "white";
        ctx.lineWidth = 6;
        ctx.strokeRect(0, 0, canvas.width, canvas.height);

        // ç¹ªè£½ç‰©ä»¶
        drawPaddle(user);
        drawPaddle(com);
        drawBall(ball);

        // åˆ†æ•¸
        drawText(user.score, 50, canvas.height / 2 + 50, "white");
        drawText(com.score, 50, canvas.height / 2 - 20, "white");
    }

    // éŠæˆ²è¿´åœˆ
    function game() {
        update();
        render();
        requestAnimationFrame(game);
    }

    // --- é›£åº¦è¨­å®š ---
    function setDifficulty(level) {
        // ç§»é™¤ä¸¦è¨­å®š active æ¨£å¼
        document.querySelectorAll('.controls button').forEach(btn => btn.classList.remove('active'));
        document.getElementById('btn-' + level).classList.add('active');

        // é‡ç½®åˆ†æ•¸å’Œçƒ
        user.score = 0;
        com.score = 0;
        resetBall();

        // è¨­å®š AI åƒæ•¸
        switch (level) {
            case 'easy':
                difficultyLevel = 0.04; // é›»è…¦åæ‡‰æ…¢ï¼Œå®¹æ˜“æ‰“ç©º
                break;
            case 'medium':
                difficultyLevel = 0.08; // é›»è…¦åæ‡‰æ™®é€š
                break;
            case 'hard':
                difficultyLevel = 0.15; // é›»è…¦åæ‡‰æ¥µå¿«
                break;
        }
    }

    // å•Ÿå‹•éŠæˆ²
    game();
</script>
</body>
</html>